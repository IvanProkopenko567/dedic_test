# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

variables:
- name: projectDirectory
  value: '.'
- group: keystore
- name: androidKeystoreAlias
  value: $[variables.ANDROID_KEYSTORE_ALIAS]
- name: androidKeystorePrivateKeyPassword
  value: $[variables.ANDROID_KEYSTORE_PRIVATE_KEY_PASSWORD]
- name: androidKeystorePassword
  value: $[variables.ANDROID_KEYSTORE_PASSWORD]



trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:

- task: FlutterInstall@0
  inputs:
    channel: 'stable'
    version: 'latest'

      

- task: FlutterBuild@0
  inputs:
    target: apk
    projectDirectory: $(projectDirectory)


- task: AndroidSigning@3
  displayName: 'Signing and aligning APK file(s) **/*.apk'
  inputs:
   apkFiles: '**/*.apk'
   apksign: true
   apksignerKeystoreFile: key_109.jks
   apksignerKeystorePassword: $(androidKeystorePassword)
   apksignerKeystoreAlias: $(androidKeystoreAlias)
   apksignerKeyPassword: $(androidKeystorePrivateKeyPassword)

- task: CopyFiles@2
  inputs:
    contents: '**/*.apk'
    targetFolder: '$(build.artifactStagingDirectory)'
  displayName: 'copy files'
- task: PublishBuildArtifacts@1
  inputs:
    artifactName: 'drop'
  displayName: 'publish'

